---
import BaseLayout from '../layouts/BaseLayout.astro';
import SEO from '../components/SEO.astro';
import StructuredData from '../components/StructuredData.astro';
import ForwardLink from '../components/ForwardLink.astro';
import { getCollection } from 'astro:content';
import { siteConfig } from '../config';

/**
 * Queries and filters featured projects for hero section
 *
 * Retrieves all projects, filters for featured ones, sorts by custom order
 * (if specified), and limits to top 2 for the hero snapshots.
 */
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
	.filter((project) => project.data.featured === true)
	.sort((a, b) => (a.data.order || 999) - (b.data.order || 999))
	.slice(0, 2);

/**
 * Case snapshots for hero display
 *
 * Takes up to 3 featured projects to showcase in the hero section,
 * providing immediate evidence of impact and outcomes.
 */
const caseSnapshots = featuredProjects.slice(0, 3);

/**
 * Queries recent writing for preview section
 *
 * Retrieves all writing, sorts by date (newest first), and limits to
 * top 2 for the homepage preview.
 */
const allWriting = await getCollection('writing');
const recentWriting = allWriting
	.sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
	.slice(0, 2);
---

<BaseLayout>
	<SEO
		slot="head"
		title={`${siteConfig.author.name} - ${siteConfig.author.title}`}
		description={siteConfig.description}
		type="website"
		noSuffix
	/>

	<!-- Structured Data for Homepage -->
	<StructuredData type="WebSite" />
	<StructuredData type="Person" />

	<main class="home-page">
		<!-- CASE-FIRST HERO -->
		<section class="hero">
			<div class="hero-grid">
				<div class="hero-left">
					<h1 class="hero-title">
						I build what I wish existed.<br />
						<span class="hero-title-emphasis">
							Backend systems, mobile apps, and car projects + lessons learned along the way.
						</span>
					</h1>

					<p class="hero-sub">
						This is my personal corner of the internet: a collection of things I've built, things I'm
						exploring, and the thinking behind them. Sometimes it's technical, sometimes it's cars. Mostly
						it's me learning in public.
					</p>

					<p class="hero-meta">
						{siteConfig.author.name} · {siteConfig.author.title}
					</p>

					<div class="hero-cta">
						<a href="/projects" class="btn-primary">View Projects</a>
						<a href="/writing" class="btn-secondary">Writing</a>
					</div>
				</div>

				<!-- Right: Case Snapshots -->
				<div class="hero-right">
					<div class="case-snapshots">
						{
							caseSnapshots.map((project) => (
								<a href={`/projects/${project.id}`} class="case-snapshot">
									<span class="case-label">Case · {project.data.role}</span>
									<span class="case-title">{project.data.title}</span>
									<span class="case-outcome">{project.data.outcomeSummary}</span>
								</a>
							))
						}
					</div>
				</div>
			</div>
		</section>

		<!-- Recent Writing -->
		<section class="recent-writing">
			<div class="section-header">
				<h2>Recent Writing</h2>
				<ForwardLink href="/writing" text="View all" variant="muted" />
			</div>
			{
				recentWriting.length > 0 ? (
					<div class="writing-list">
						{recentWriting.map((writing) => {
							const date = new Date(writing.data.publishDate);
							const formattedDate = date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
							return (
								<article class="writing-item">
									<span class="writing-date">{formattedDate}</span>
									<h3 class="writing-title">{writing.data.title}</h3>
									<p class="writing-context">{writing.data.description}</p>
								</article>
							);
						})}
					</div>
				) : (
					<p class="no-writing">No writing documented yet.</p>
				)
			}
		</section>

		<!-- What I Think About -->
		<section class="thinking">
			<h2>Things I Like Building & Thinking About</h2>
			<p class="thinking-list">
				Backend systems that scale · Mobile features people actually use · Turning side projects into real
				products · Reverse-engineering car tech and custom mods · Making messy systems understandable · Simple
				solutions over clever ones · Writing things down so lessons don't get lost
			</p>
		</section>

		<!-- CTA -->
		<section class="cta">
			<h2>Let's Build Something</h2>
			<p>
				Interested in collaborating, chatting about ideas, or just seeing what I'm working on? Feel free to
				reach out.
			</p>
			<div class="cta-buttons">
				<a href="/projects" class="btn-primary">View My Work</a>
				<a href="/contact" class="btn-secondary">Get in Touch</a>
			</div>
		</section>
	</main>

	<style>
		.home-page {
			max-width: 1100px;
			margin: 0 auto;
			padding: 0 1.5rem 4rem;
		}

		.hero {
			padding: 4rem 0 5rem;
			border-bottom: 1px solid var(--color-border);
			margin-bottom: 4rem;
		}

		.hero-grid {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 4rem;
			align-items: start;
		}

		.hero-left {
			padding-right: 2rem;
		}

		.hero-title {
			font-size: 2.25rem;
			line-height: 1.3;
			font-weight: 600;
			letter-spacing: -0.02em;
			margin-bottom: 1.5rem;
			color: var(--color-text);
		}

		.hero-title-emphasis {
			color: var(--color-text-secondary);
		}

		.hero-sub {
			font-size: 1.125rem;
			color: var(--color-text-secondary);
			margin-bottom: 1.5rem;
			line-height: 1.6;
		}

		.hero-meta {
			font-size: 0.875rem;
			color: var(--color-text-muted);
			margin-bottom: 2rem;
			letter-spacing: 0.01em;
		}

		.hero-cta {
			display: flex;
			gap: 1rem;
		}

		.btn-primary {
			display: inline-block;
			padding: 0.75rem 1.5rem;
			background: var(--color-text);
			color: var(--color-bg);
			font-weight: 600;
			font-size: 0.9375rem;
			text-decoration: none;
			border-radius: 6px;
			transition: opacity 0.2s ease;
		}

		.btn-primary:hover {
			opacity: 0.85;
		}

		.btn-secondary {
			display: inline-block;
			padding: 0.75rem 1.5rem;
			background: transparent;
			color: var(--color-text);
			font-weight: 500;
			font-size: 0.9375rem;
			text-decoration: none;
			border: 1px solid var(--color-border);
			border-radius: 6px;
			transition: border-color 0.2s ease;
		}

		.btn-secondary:hover {
			border-color: var(--color-text-secondary);
		}

		.hero-right {
			padding-top: 0.5rem;
		}

		.case-snapshots {
			display: flex;
			flex-direction: column;
			gap: 1rem;
		}

		.case-snapshot {
			display: block;
			padding: 1.25rem 1.5rem;
			background: var(--color-bg-secondary);
			border: 1px solid var(--color-border);
			border-radius: 8px;
			text-decoration: none;
			transition:
				border-color 0.2s ease,
				background 0.2s ease;
		}

		.case-snapshot:hover {
			border-color: var(--color-text-muted);
			background: var(--color-bg-elevated);
		}

		.case-label {
			display: block;
			font-size: 0.6875rem;
			font-weight: 600;
			text-transform: uppercase;
			letter-spacing: 0.08em;
			color: var(--color-text-muted);
			margin-bottom: 0.375rem;
		}

		.case-title {
			display: block;
			font-size: 1rem;
			font-weight: 600;
			color: var(--color-text);
			margin-bottom: 0.5rem;
			line-height: 1.4;
		}

		.case-outcome {
			display: block;
			font-size: 0.875rem;
			color: var(--color-text-secondary);
			line-height: 1.5;
		}

		.introduction {
			max-width: 600px;
			margin-bottom: 5rem;
			font-size: 1.125rem;
			line-height: 1.7;
			color: var(--color-text-secondary);
		}

		.introduction p {
			margin-bottom: 1rem;
		}

		.introduction p:first-child {
			color: var(--color-text);
		}

		.recent-writing {
			margin-bottom: 5rem;
		}

		.section-header {
			display: flex;
			align-items: baseline;
			justify-content: space-between;
			margin-bottom: 2rem;
		}

		.section-header h2 {
			font-size: 1.25rem;
			font-weight: 600;
			letter-spacing: -0.01em;
		}

		.writing-list {
			display: flex;
			flex-direction: column;
			gap: 0;
			border-top: 1px solid var(--color-border);
		}

		.writing-item {
			padding: 1.5rem 0;
			border-bottom: 1px solid var(--color-border);
		}

		.writing-item:last-child {
			border-bottom: none;
		}

		.writing-date {
			display: block;
			font-size: 0.75rem;
			font-weight: 500;
			text-transform: uppercase;
			letter-spacing: 0.05em;
			color: var(--color-text-muted);
			margin-bottom: 0.5rem;
		}

		.writing-title {
			font-size: 1.125rem;
			font-weight: 600;
			line-height: 1.3;
			color: var(--color-text);
			margin-bottom: 0.5rem;
		}

		.writing-context {
			font-size: 0.9375rem;
			line-height: 1.6;
			color: var(--color-text-secondary);
		}

		.no-writing {
			color: var(--color-text-muted);
			font-style: italic;
		}

		.thinking {
			margin-bottom: 5rem;
		}

		.thinking h2 {
			font-size: 1.25rem;
			font-weight: 600;
			margin-bottom: 1.25rem;
			letter-spacing: -0.01em;
		}

		.thinking-list {
			font-size: 1.0625rem;
			line-height: 1.9;
			color: var(--color-text-secondary);
			max-width: 680px;
		}

		.cta {
			padding: 3rem 0;
			border-top: 1px solid var(--color-border);
		}

		.cta h2 {
			font-size: 1.5rem;
			font-weight: 600;
			margin-bottom: 0.75rem;
			letter-spacing: -0.01em;
		}

		.cta p {
			font-size: 1rem;
			color: var(--color-text-secondary);
			margin-bottom: 1.5rem;
			max-width: 500px;
			line-height: 1.6;
		}

		.cta-buttons {
			display: flex;
			gap: 1rem;
		}

		@media (max-width: 768px) {
			.home-page {
				padding: 0 1rem 3rem;
			}

			.hero {
				padding: 2.5rem 0 3rem;
			}

			.hero-grid {
				grid-template-columns: 1fr;
				gap: 2.5rem;
			}

			.hero-left {
				padding-right: 0;
			}

			.hero-title {
				font-size: 1.75rem;
			}

			.hero-cta {
				flex-direction: column;
			}

			.btn-primary,
			.btn-secondary {
				text-align: center;
				width: 100%;
			}

			.case-snapshot {
				padding: 1rem 1.25rem;
			}

			.introduction {
				font-size: 1rem;
			}

			.section-header {
				flex-direction: column;
				align-items: flex-start;
				gap: 0.5rem;
			}

			.writing-title {
				font-size: 1rem;
			}

			.cta-buttons {
				flex-direction: column;
			}

			.cta-buttons .btn-primary,
			.cta-buttons .btn-secondary {
				width: 100%;
			}
		}
	</style>
</BaseLayout>
