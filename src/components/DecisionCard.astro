---
import BaseCard from './BaseCard.astro';
import ForwardLink from './ForwardLink.astro';

interface Props {
  title: string; 
  slug: string;
  context: string;
  date: Date;
  tags?: string[];
  maxContextLength?: number;
}

const { title, slug, context, date, tags = [], maxContextLength = 180 } = Astro.props;

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long'
  }).format(date);
}

function truncate(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength).trim() + '...';
}

const truncatedContext = truncate(context, maxContextLength);
---

<BaseCard href={`/writings/${slug}`} class="writing-card">
  <Fragment slot="meta">{formatDate(date)}</Fragment>
  <Fragment slot="title">{title}</Fragment>
  <Fragment slot="description">{truncatedContext}</Fragment>
  
  {tags.length > 0 && (
    <div slot="tags" class="tags-list">
      {tags.map((tag) => (
        <span class="tag">{tag}</span>
      ))}
    </div>
  )}
  
  <ForwardLink text="Read writing" />
</BaseCard>
